# 작업 이력 - 2025-01-07

## 14:00 - ArgoCD Terraform 모듈 및 55-argocd 레이어 생성

### 변경 사항

- 신규 파일: `modules/argocd/main.tf`
  - Helm Provider를 사용한 ArgoCD 설치
  - Kubernetes Namespace 생성
  - ArgoCD Helm Release 리소스

- 신규 파일: `modules/argocd/variables.tf`
  - 차트 버전, Namespace 설정
  - Server/Controller/Repo Server Replicas
  - Ingress, SSO (Dex), Notifications 설정
  - Resource limits 설정

- 신규 파일: `modules/argocd/outputs.tf`
  - Namespace, Release name, Server URL 출력

- 신규 파일: `modules/argocd/versions.tf`
  - Helm, Kubernetes Provider 버전 요구사항

- 신규 파일: `environments/prod/55-argocd/terragrunt.hcl`
  - EKS 클러스터, Node Group 의존성
  - Helm/Kubernetes Provider 동적 생성
  - common.hcl에서 ArgoCD 설정 참조

- 수정 파일: `environments/prod/common.hcl`
  - ArgoCD 설정 블록 추가
  - chart_version, replicas, 기능 토글

- 수정 파일: `.github/workflows/terragrunt-apply.yml`
  - 55-argocd 레이어 추가

- 수정 파일: `.github/workflows/terragrunt-destroy.yml`
  - 55-argocd 레이어 추가
  - 삭제 순서 업데이트

- 수정 파일: `docs/README.md`
  - 디렉토리 구조에 argocd 모듈 및 55-argocd 레이어 추가
  - 삭제 순서 업데이트

- 수정 파일: `docs/architecture.md`
  - 레이어 배포 다이어그램 업데이트 (ArgoCD → Istio/Apps)
  - 레이어별 설명 테이블에 55-argocd 추가

### 설계 결정

ArgoCD만 Terraform으로 설치하고, 이후 K8s 워크로드(Istio, Helm 차트, 애플리케이션)는
ArgoCD App of Apps 패턴으로 관리하는 것이 베스트 프랙티스

```text
Terraform 영역                ArgoCD 영역 (GitOps)
─────────────                ──────────────────
• VPC, EKS, RDS              • Istio
• IAM Roles (IRSA)           • cert-manager
• ArgoCD 설치 ──────────────► • aws-lb-controller
                             • 애플리케이션들
```

### 배포 순서

```text
00-foundation → 05-cloudwatch → 10-networking → 20-security → 30-eks-cluster → 40-nodegroups → 50-addons → 55-argocd → 60-database
```

### 삭제 순서

```text
60-database → 55-argocd → 50-addons → 40-nodegroups → 30-eks-cluster → 20-security → 10-networking → 05-cloudwatch → 00-foundation
```

### 다음 단계

1. EKS 클러스터 배포 후 55-argocd 레이어 적용
2. ArgoCD UI 접속 확인
3. App of Apps 패턴으로 Istio, cert-manager 등 설치
